<?xml version="1.0" encoding="utf-8"?>
<installer-gui-script minSpecVersion="2">
    <title>stuffbucket VS Code Lima Extension</title>
    <organization>com.stuffbucket</organization>
    <domains enable_localSystem="true"/>
    <options customize="never" require-scripts="true" rootVolumeOnly="true"/>
    
    <welcome file="welcome.html" mime-type="text/html"/>
    <license file="../../LICENSE" mime-type="text/plain"/>
    <conclusion file="conclusion.html" mime-type="text/html"/>
    
    <!-- Require Homebrew package -->
    <installation-check script="homebrewCheck()"/>
    
    <script>
    function homebrewCheck() {
        // Check both possible Homebrew locations (arm64 and x86_64)
        var arm64Path = '/opt/homebrew/bin/brew';
        var x86Path = '/usr/local/bin/brew';
        
        if (system.files.fileExistsAtPath(arm64Path) || system.files.fileExistsAtPath(x86Path)) {
            return true;
        }
        
        my.result.title = 'Homebrew Required';
        my.result.message = 'This package requires Homebrew to be installed first. Please install the stuffbucket Homebrew package.';
        my.result.type = 'Fatal';
        return false;
    }
    </script>
    
    <pkg-ref id="com.stuffbucket.vscode-lima">
        <bundle-version/>
    </pkg-ref>
    
    <choices-outline>
        <line choice="default">
            <line choice="com.stuffbucket.vscode-lima"/>
        </line>
    </choices-outline>
    
    <choice id="default"/>
    <choice id="com.stuffbucket.vscode-lima" visible="false">
        <pkg-ref id="com.stuffbucket.vscode-lima"/>
    </choice>
    
    <pkg-ref id="com.stuffbucket.vscode-lima" version="0.0.0" onConclusion="none">vscode-lima.pkg</pkg-ref>
</installer-gui-script>
